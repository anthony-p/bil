<?/** * Created by JetBrains PhpStorm. * User: Igor * Date: 7/26/13 * Time: 9:20 PM * To change this template use File | Settings | File Templates. */session_start();/*include_once ('includes/npglobal.php');include_once ('includes/npclass_formchecker.php');include_once ('includes/npclass_custom_field.php');include_once ('includes/npclass_item.php');*/include_once ('includes/global.php');include_once ('includes/class_project_rewards.php');//include_once ('includes/npclass_project_updates.php');include_once ('includes/npfunctions_login.php');if (!$session->value('user_id')) {    header_redirect('../login.php');} else {    if ($_POST['add_project_updates'] == true) {        $data['project_id'] = $_POST['project_id'];        $data['comment']    = $_POST['comment'];        $data['user_id']    = $session->value('user_id');        /*        $npProjectUpdates   = new npProjectUpdates();        $npProjectUpdates->insert($data);        $recordId = $npProjectUpdates->getLastComment();*/        $project_updates = $db->rem_special_chars_array($data);        $insert_query = "INSERT INTO project_updates(user_id, project_id, parrent_id, comment, create_at) VALUES";        $insert_query .= "(" .            $project_updates["user_id"] . ", " .            $project_updates["project_id"] . ", '" .            $project_updates["parrent_id"] . "', '" .            $project_updates["comment"] . "', '" .            $currentTime .            "')";        $sql_insert_pitch = $db->query($insert_query);        $recordId = $db->query("SELECT id FROM project_updates ORDER BY id DESC LIMIT 1");        $rowSearched = array();        while ($row = mysql_fetch_array($recordId)) {            $rowSearched = $row;        }        if (!empty($recordId)) {            echo json_encode(array("response" => true, "id" => $rowSearched['id']));        } else {            echo json_encode(array("response" => "error"));        }    } elseif ($_POST['add_project_rewards'] == true) {        $data['project_id'] = $_POST['project_id'];        $data['comment']    = $_POST['comment'];        $data['user_id']    = $session->value('user_id');        /* this function don't work        $npProjectRewards   = new npProjectRewards();        $npProjectRewards->insert($data);        $recordId = $npProjectRewards->getLastComment();        */        $project_rewards = $db->rem_special_chars_array($data);        $insert_query = "INSERT INTO project_rewards(user_id, project_id, parrent_id, comment, create_at) VALUES";        $insert_query .= "(" .            $project_rewards["user_id"] . ", " .            $project_rewards["project_id"] . ", '" .            $project_rewards["parrent_id"] . "', '" .            $project_rewards["comment"] . "', '" .            $currentTime .            "')";        $sql_insert_pitch = $db->query($insert_query);        $recordId = $db->query("SELECT id FROM project_rewards ORDER BY id DESC LIMIT 1");        $rowSearched = array();        while ($row = mysql_fetch_array($recordId)) {            $rowSearched = $row;        }        if (!empty($recordId)) {            echo json_encode(array("response" => true, "id" => $rowSearched['id']));        } else {            echo json_encode(array("response" => "error"));        }	} elseif($_POST['save_project_rewards'] == true){			$reward['project_id'] = isset($_POST["campaign_id"]) ? $_POST["campaign_id"] : '';		$reward['amount'] = isset($_POST["reward_amount"]) ? $_POST["reward_amount"] : '';		$reward['name'] = isset($_POST["reward_name"]) ? $_POST["reward_name"] : '';		$reward['description'] = isset($_POST["reward_description"]) ? $_POST["reward_description"] : '';		$reward['available_number'] = isset($_POST["reward_available_number"]) ? $_POST["reward_available_number"] : '';		$reward['estimated_delivery_date'] = isset($_POST["reward_estimated_delivery_date"]) ? $_POST["reward_estimated_delivery_date"] : '';		$reward['shipping_address_required'] = isset($_POST["reward_shipping_address_required"])  && $_POST['reward_shipping_address_required'] == 'true' ? 1 : 0;				$projectRewards   = new projectRewards();		$result = $projectRewards->save($reward, $session->value('user_id'));		echo json_encode(array("response" => $result));	} elseif ($_POST['update_project_rewards'] == true){		$reward['id'] = isset($_POST["rewards_id"]) ? $_POST["rewards_id"] : '';		$reward['amount'] = isset($_POST["reward_amount"]) ? $_POST["reward_amount"] : '';		$reward['name'] = isset($_POST["reward_name"]) ? $_POST["reward_name"] : '';		$reward['description'] = isset($_POST["reward_description"]) ? $_POST["reward_description"] : '';		$reward['available_number'] = isset($_POST["reward_available_number"]) && !empty($_POST["reward_available_number"]) ? "'".intval($_POST["reward_available_number"])."'" : "NULL";		$reward['estimated_delivery_date'] = isset($_POST["reward_estimated_delivery_date"]) && !empty($_POST["reward_estimated_delivery_date"]) ? "FROM_UNIXTIME('".strtotime($_POST["reward_estimated_delivery_date"])."')" : "NULL";		$reward['shipping_address_required'] = isset($_POST["reward_shipping_address_required"])  && $_POST['reward_shipping_address_required'] == 'true' ? 1 : 0;				$projectRewards   = new projectRewards();		$result = $projectRewards->update($reward, $session->value('user_id'));		echo json_encode(array("response" => $result));    } elseif ($_POST['delete_project_rewards'] == true) {        $rewardId = isset($_POST["rewards_id"]) ? $_POST["rewards_id"] : '';		$projectRewards   = new projectRewards();        $result = $projectRewards->delete($rewardId, $session->value('user_id'));		echo json_encode(array("response" => $result));		} elseif($_POST['addNewRewardToProject']) {		$has_new_reward_form = isset($_POST['has_new_reward_form']) && $_POST['has_new_reward_form'] == 'true' ? false : true;		$campaign_id = isset($_POST['campaign_id']) ? $_POST['campaign_id'] : '';		$projectRewards   = new projectRewards();		$result = $projectRewards->addNewRewardForm($campaign_id, $has_new_reward_form);		echo json_encode(array("response" => $result));    } elseif ($_POST['delete_project_updates'] == true) {        $updatesId = $_POST["updates_id"];        if (!empty($updatesId)) {            /*            $npProjectUpdates   = new npProjectUpdates();            $npProjectUpdates->delete($rewardsId);            */            $db->query("DELETE FROM project_updates WHERE id=" . $updatesId);            echo json_encode(array("response" => true));        } else {            echo json_encode(array("response" => "error"));        }    }}